<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fantacalcio 2025 - Ultra Intelligence</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 20px;
        }

        .stats-overview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .stat-card {
            background: rgba(255,255,255,0.2);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            backdrop-filter: blur(10px);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .search-container {
            padding: 30px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
        }

        .search-box {
            position: relative;
            max-width: 600px;
            margin: 0 auto;
        }

        .search-input {
            width: 100%;
            padding: 15px 20px;
            font-size: 1.1rem;
            border: 2px solid #e9ecef;
            border-radius: 25px;
            outline: none;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .filters {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 20px;
            justify-content: center;
        }

        .filter-btn {
            padding: 8px 16px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .filter-btn.active {
            background: #667eea;
            color: white;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 30px;
            padding: 30px;
        }

        .players-grid {
            display: grid;
            gap: 20px;
        }

        .role-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }

        .role-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f1f3f4;
        }

        .role-icon {
            font-size: 2rem;
            margin-right: 15px;
        }

        .role-title {
            font-size: 1.5rem;
            font-weight: bold;
        }

        .role-count {
            margin-left: auto;
            background: #667eea;
            color: white;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.9rem;
        }

        .player-card {
            display: flex;
            align-items: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 12px;
            margin-bottom: 10px;
            transition: all 0.3s ease;
            cursor: pointer;
            border-left: 4px solid transparent;
        }

        .player-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border-left-color: #667eea;
        }

        .player-info {
            flex: 1;
        }

        .player-name {
            font-weight: bold;
            font-size: 1.1rem;
            margin-bottom: 5px;
        }

        .player-team {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 8px;
        }

        .player-stats {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .stat-badge {
            background: #e9ecef;
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 0.8rem;
            color: #495057;
        }

        .stat-badge.excellent { background: #d4edda; color: #155724; }
        .stat-badge.good { background: #fff3cd; color: #856404; }
        .stat-badge.average { background: #f8d7da; color: #721c24; }

        .player-price {
            text-align: center;
            margin-left: 15px;
        }

        .smart-price {
            font-size: 1.3rem;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .price-range {
            font-size: 0.8rem;
            color: #666;
        }

        .opportunity-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #28a745;
            color: white;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 0.7rem;
            font-weight: bold;
        }

        .sidebar {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            height: fit-content;
            position: sticky;
            top: 20px;
        }

        .sidebar-section {
            margin-bottom: 30px;
        }

        .sidebar-title {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
        }

        .quick-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .quick-stat {
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 12px;
        }

        .quick-stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #667eea;
        }

        .quick-stat-label {
            font-size: 0.9rem;
            color: #666;
            margin-top: 5px;
        }

        .recommendations {
            list-style: none;
        }

        .recommendation {
            padding: 12px;
            background: #f8f9fa;
            border-radius: 10px;
            margin-bottom: 10px;
            border-left: 3px solid #28a745;
        }

        .recommendation-text {
            font-size: 0.9rem;
            color: #333;
        }

        .recommendation-price {
            font-weight: bold;
            color: #28a745;
            margin-top: 3px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
                gap: 20px;
                padding: 20px;
            }
            
            .sidebar {
                order: -1;
                position: static;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .stats-overview {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .advanced-filters {
            background: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .filter-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .filter-group {
            flex: 1;
            min-width: 150px;
        }

        .filter-label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #555;
        }

        .filter-select {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: white;
        }

        .price-range-slider {
            margin-top: 10px;
        }

        .range-input {
            width: 100%;
            margin-bottom: 5px;
        }

        .range-values {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            color: #666;
        }

        .ai-insights {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .insight-title {
            font-size: 1.1rem;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .insight-text {
            font-size: 0.95rem;
            line-height: 1.5;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            line-height: 1;
        }

        .close:hover {
            color: #333;
        }

        .player-details {
            display: grid;
            gap: 20px;
        }

        .detail-section {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
        }

        .detail-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
        }

        .price-analysis {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .source-price {
            text-align: center;
            padding: 10px;
            background: white;
            border-radius: 8px;
            border: 1px solid #ddd;
        }

        .source-name {
            font-size: 0.8rem;
            color: #666;
            margin-bottom: 5px;
        }

        .source-value {
            font-weight: bold;
            color: #667eea;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Fantacalcio 2025</h1>
            <div class="subtitle">Ultra-Intelligent Database & Smart Pricing</div>
            <div class="stats-overview">
                <div class="stat-card">
                    <div class="stat-value" id="total-players">465</div>
                    <div class="stat-label">Giocatori Totali</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">4</div>
                    <div class="stat-label">Fonti Dati</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">2</div>
                    <div class="stat-label">Stagioni</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="avg-consensus">86%</div>
                    <div class="stat-label">Consenso Medio</div>
                </div>
            </div>
        </div>

        <div class="search-container">
            <div class="search-box">
                <input type="text" class="search-input" placeholder="🔍 Cerca giocatori... (nome, team, stats)"
                       id="search-input">
            </div>
            <div class="filters" id="role-filters">
                <button class="filter-btn active" data-role="all">Tutti</button>
                <button class="filter-btn" data-role="P">🥅 Portieri</button>
                <button class="filter-btn" data-role="D">🛡️ Difensori</button>
                <button class="filter-btn" data-role="C">⚡ Centrocampisti</button>
                <button class="filter-btn" data-role="A">⚔️ Attaccanti</button>
            </div>
        </div>

        <div class="main-content">
            <div class="players-section">
                <div class="advanced-filters">
                    <div class="filter-row">
                        <div class="filter-group">
                            <label class="filter-label">Fascia di Prezzo</label>
                            <select class="filter-select" id="price-filter">
                                <option value="all">Tutte le fasce</option>
                                <option value="top">Top (40+)</option>
                                <option value="semitop">Semitop (20-40)</option>
                                <option value="mid">Media (10-20)</option>
                                <option value="low">Low Cost (1-10)</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label class="filter-label">Affidabilità</label>
                            <select class="filter-select" id="reliability-filter">
                                <option value="all">Tutte</option>
                                <option value="5">⭐⭐⭐⭐⭐</option>
                                <option value="4">⭐⭐⭐⭐</option>
                                <option value="3">⭐⭐⭐</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label class="filter-label">Opportunità</label>
                            <select class="filter-select" id="opportunity-filter">
                                <option value="all">Tutte</option>
                                <option value="high">🔥 Alta</option>
                                <option value="medium">📈 Media</option>
                                <option value="low">⚖️ Equilibrio</option>
                            </select>
                        </div>
                    </div>
                    <div class="price-range-slider">
                        <label class="filter-label">Range di Prezzo</label>
                        <input type="range" class="range-input" id="min-price" min="1" max="100" value="1">
                        <input type="range" class="range-input" id="max-price" min="1" max="100" value="100">
                        <div class="range-values">
                            <span id="min-price-val">1</span>
                            <span id="max-price-val">100</span>
                        </div>
                    </div>
                </div>

                <div class="players-grid" id="players-grid">
                    <div class="loading">
                        <div class="spinner"></div>
                        Caricamento database intelligente...
                    </div>
                </div>
            </div>

            <div class="sidebar">
                <div class="sidebar-section">
                    <div class="sidebar-title">📊 Statistiche Live</div>
                    <div class="quick-stats">
                        <div class="quick-stat">
                            <div class="quick-stat-value" id="filtered-count">465</div>
                            <div class="quick-stat-label">Risultati</div>
                        </div>
                        <div class="quick-stat">
                            <div class="quick-stat-value" id="avg-price">€24</div>
                            <div class="quick-stat-label">Prezzo Medio</div>
                        </div>
                    </div>
                </div>

                <div class="sidebar-section">
                    <div class="ai-insights">
                        <div class="insight-title">🤖 AI Insights</div>
                        <div class="insight-text" id="ai-insight">
                            Analizzando le tendenze di mercato e le performance storiche...
                        </div>
                    </div>
                </div>

                <div class="sidebar-section">
                    <div class="sidebar-title">💎 Opportunità Top</div>
                    <ul class="recommendations" id="top-opportunities">
                        <li class="recommendation">
                            <div class="recommendation-text">Caricamento opportunità...</div>
                        </li>
                    </ul>
                </div>

                <div class="sidebar-section">
                    <div class="sidebar-title">📈 Trend Prezzi</div>
                    <div class="quick-stats">
                        <div class="quick-stat">
                            <div class="quick-stat-value" id="rising-trend">+12%</div>
                            <div class="quick-stat-label">Trend Rialzista</div>
                        </div>
                        <div class="quick-stat">
                            <div class="quick-stat-value" id="volatility">Low</div>
                            <div class="quick-stat-label">Volatilità</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Player Detail Modal -->
    <div id="player-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <div id="player-details"></div>
        </div>
    </div>

    <script>
        // 🔥 EMBEDDED ULTRA-INTELLIGENT DATABASE
        const PLAYERS_DB = {"P":[["SVILAR","ROM",[45,50,46.8],{"t":5,"a":5,"i":5,"f":6.25},{"g":0,"as":0.0,"p":2,"mv":6.25,"gs":0,"rp":0,"amm":0},"Top",{"sos_fanta_2025":45,"sos_fanta_2024":45,"profeta_2025":50,"profeta_2024":50,"fantaboom_2025":45,"fantaboom_2024":45,"fantaclassic_2025":47,"fantaclassic_2024":47}],["DI GREGORIO","JUV",[44,50,47.0],{"t":4,"a":5,"i":4,"f":6.25},{"g":0,"as":0.0,"p":2,"mv":6.25,"gs":0,"rp":0,"amm":0},"Top",{"sos_fanta_2025":44,"sos_fanta_2024":44,"profeta_2025":50,"profeta_2024":50,"fantaboom_2025":49,"fantaboom_2024":49,"fantaclassic_2025":45,"fantaclassic_2024":45}],["MAIGNAN","MIL",[42,50,45.8],{"t":5,"a":4,"i":3,"f":5.0},{"g":0,"as":0.0,"p":2,"mv":6.0,"gs":2,"rp":0,"amm":0},"Top",{"sos_fanta_2025":42,"sos_fanta_2024":42,"profeta_2025":45,"profeta_2024":45,"fantaboom_2025":50,"fantaboom_2024":50,"fantaclassic_2025":46,"fantaclassic_2024":46}],["SOMMER","INT",[42,48,45.8],{"t":4,"a":5,"i":3,"f":5.0},{"g":0,"as":0.0,"p":2,"mv":6.0,"gs":2,"rp":0,"amm":0},"Top",{"sos_fanta_2025":42,"sos_fanta_2024":42,"profeta_2025":45,"profeta_2024":45,"fantaboom_2025":48,"fantaboom_2024":48,"fantaclassic_2025":48,"fantaclassic_2024":48}],["MERET","NAP",[40,50,44.8],{"t":3,"a":4,"i":3,"f":6.0},{"g":0,"as":0.0,"p":2,"mv":6.0,"gs":0,"rp":0,"amm":0},"Top",{"sos_fanta_2025":40,"sos_fanta_2024":40,"profeta_2025":50,"profeta_2024":50,"fantaboom_2025":45,"fantaboom_2024":45,"fantaclassic_2025":44,"fantaclassic_2024":44}]],"D":[["DUMFRIES","INT",[44,45,44.5],{"t":4,"a":4,"i":3,"f":8.0},{"g":1,"as":0.0,"p":2,"mv":6.5,"amm":0,"esp":0},"Top",{"sos_fanta_2025":45,"sos_fanta_2024":45,"profeta_2025":45,"profeta_2024":45,"fantaboom_2025":44,"fantaboom_2024":44,"fantaclassic_2025":44,"fantaclassic_2024":44}],["DIMARCO","INT",[40,42,40.8],{"t":5,"a":5,"i":3,"f":6.25},{"g":0,"as":0.0,"p":2,"mv":6.25,"amm":0,"esp":0},"Top",{"sos_fanta_2025":40,"sos_fanta_2024":40,"profeta_2025":40,"profeta_2024":40,"fantaboom_2025":42,"fantaboom_2024":42,"fantaclassic_2025":41,"fantaclassic_2024":41}],["GOSENS","FIO",[33,37,35.0],{"t":4,"a":4,"i":2,"f":6.25},{"g":0,"as":0.0,"p":2,"mv":6.25,"amm":0,"esp":0},"Semitop",{"sos_fanta_2025":35,"sos_fanta_2024":35,"profeta_2025":37,"profeta_2024":37,"fantaboom_2025":35,"fantaboom_2024":35,"fantaclassic_2025":33,"fantaclassic_2024":33}],["BASTONI","INT",[30,35,32.8],{"t":5,"a":5,"i":4,"f":8.5},{"g":1,"as":1.0,"p":2,"mv":6.5,"amm":0,"esp":0},"Semitop",{"sos_fanta_2025":34,"sos_fanta_2024":34,"profeta_2025":35,"profeta_2024":35,"fantaboom_2025":30,"fantaboom_2024":30,"fantaclassic_2025":32,"fantaclassic_2024":32}],["BREMER","JUV",[30,33,31.0],{"t":5,"a":5,"i":2,"f":6.25},{"g":0,"as":0.0,"p":2,"mv":6.25,"amm":0,"esp":0},"Semitop",{"sos_fanta_2025":33,"sos_fanta_2024":33,"profeta_2025":30,"profeta_2024":30,"fantaboom_2025":30,"fantaboom_2024":30,"fantaclassic_2025":31,"fantaclassic_2024":31}]],"C":[["MCTOMINAY","NAP",[40,50,45.0],{"t":4,"a":5,"i":5,"f":6.0},{"g":1,"as":0,"rs":0,"rsb":0,"p":2,"pt":0,"pi":0.0,"min":0.0,"mv":6.0,"fexp":6.0},{"amm":1,"esp":0,"bud":0.0,"pma":"","quo":0},"Semitop",{"comm":"","n1":"","n2":"","n3":"","n4":"","n5":""},{"sos_fanta_2025":40,"sos_fanta_2024":40,"profeta_2025":45,"profeta_2024":45,"fantaboom_2025":50,"fantaboom_2024":50,"fantaclassic_2025":45,"fantaclassic_2024":45}],["KOOPMEINERS","JUV",[37,45,40.5],{"t":3,"a":4,"i":2,"f":0.0},{"g":0,"as":0,"rs":0,"rsb":0,"p":0,"pt":0,"pi":0.0,"min":0.0,"mv":0.0,"fexp":0.0},{"amm":0,"esp":0,"bud":0.0,"pma":"","quo":0},"Semitop",{"comm":"","n1":"","n2":"","n3":"","n4":"","n5":""},{"sos_fanta_2025":37,"sos_fanta_2024":37,"profeta_2025":40,"profeta_2024":40,"fantaboom_2025":45,"fantaboom_2024":45,"fantaclassic_2025":37,"fantaclassic_2024":37}],["BARELLA","INT",[35,42,38.8],{"t":4,"a":4,"i":3,"f":5.75},{"g":0,"as":0,"rs":0,"rsb":0,"p":2,"pt":0,"pi":0.0,"min":0.0,"mv":6.0,"fexp":5.5},{"amm":1,"esp":0,"bud":0.0,"pma":"","quo":0},"Semitop",{"comm":"","n1":"","n2":"","n3":"","n4":"","n5":""},{"sos_fanta_2025":35,"sos_fanta_2024":35,"profeta_2025":40,"profeta_2024":40,"fantaboom_2025":42,"fantaboom_2024":42,"fantaclassic_2025":38,"fantaclassic_2024":38}],["CALHANOGLU","INT",[30,38,34.2],{"t":4,"a":4,"i":2,"f":6.75},{"g":1,"as":0,"rs":1,"rsb":0,"p":2,"pt":0,"pi":0.0,"min":0.0,"mv":6.25,"fexp":7.25},{"amm":0,"esp":0,"bud":0.0,"pma":"","quo":0},"Semitop",{"comm":"","n1":"","n2":"","n3":"","n4":"","n5":""},{"sos_fanta_2025":30,"sos_fanta_2024":30,"profeta_2025":35,"profeta_2024":35,"fantaboom_2025":38,"fantaboom_2024":38,"fantaclassic_2025":34,"fantaclassic_2024":34}],["TONALI","MIL",[28,35,31.5],{"t":4,"a":4,"i":3,"f":6.0},{"g":0,"as":0,"rs":0,"rsb":0,"p":2,"pt":0,"pi":0.0,"min":0.0,"mv":6.0,"fexp":6.0},{"amm":0,"esp":0,"bud":0.0,"pma":"","quo":0},"Semitop",{"comm":"","n1":"","n2":"","n3":"","n4":"","n5":""},{"sos_fanta_2025":28,"sos_fanta_2024":28,"profeta_2025":32,"profeta_2024":32,"fantaboom_2025":35,"fantaboom_2024":35,"fantaclassic_2025":31,"fantaclassic_2024":31}]],"A":[["MARTINEZ L.","INT",[65,80,72.8],{"t":5,"a":5,"i":3,"f":7.75},{"g":2,"as":0.0,"rs":0,"rsb":0,"p":2,"pt":0,"pi":0.0,"min":0.0,"mv":7.25,"fexp":8.25},{"amm":0,"esp":0,"bud":0.0,"pma":"","quo":0},"Top",{"comm":"","n1":"","n2":"","n3":"","n4":"","n5":""},{"sos_fanta_2025":65,"sos_fanta_2024":65,"profeta_2025":75,"profeta_2024":75,"fantaboom_2025":80,"fantaboom_2024":80,"fantaclassic_2025":71,"fantaclassic_2024":71}],["HAALAND","MCI",[60,75,67.5],{"t":5,"a":5,"i":4,"f":8.5},{"g":3,"as":0.0,"rs":0,"rsb":0,"p":2,"pt":0,"pi":0.0,"min":0.0,"mv":8.0,"fexp":9.0},{"amm":0,"esp":0,"bud":0.0,"pma":"","quo":0},"Top",{"comm":"","n1":"","n2":"","n3":"","n4":"","n5":""},{"sos_fanta_2025":60,"sos_fanta_2024":60,"profeta_2025":65,"profeta_2024":65,"fantaboom_2025":75,"fantaboom_2024":75,"fantaclassic_2025":70,"fantaclassic_2024":70}],["OSIMHEN","NAP",[55,70,62.5],{"t":4,"a":4,"i":2,"f":7.25},{"g":1,"as":1.0,"rs":0,"rsb":0,"p":2,"pt":0,"pi":0.0,"min":0.0,"mv":7.5,"fexp":7.0},{"amm":0,"esp":0,"bud":0.0,"pma":"","quo":0},"Top",{"comm":"","n1":"","n2":"","n3":"","n4":"","n5":""},{"sos_fanta_2025":55,"sos_fanta_2024":55,"profeta_2025":65,"profeta_2024":65,"fantaboom_2025":70,"fantaboom_2024":70,"fantaclassic_2025":60,"fantaclassic_2024":60}],["VLAHOVIC","JUV",[50,65,57.5],{"t":4,"a":4,"i":3,"f":6.75},{"g":1,"as":0.0,"rs":1,"rsb":0,"p":2,"pt":0,"pi":0.0,"min":0.0,"mv":6.5,"fexp":7.0},{"amm":0,"esp":0,"bud":0.0,"pma":"","quo":0},"Semitop",{"comm":"","n1":"","n2":"","n3":"","n4":"","n5":""},{"sos_fanta_2025":50,"sos_fanta_2024":50,"profeta_2025":60,"profeta_2024":60,"fantaboom_2025":65,"fantaboom_2024":65,"fantaclassic_2025":55,"fantaclassic_2024":55}],["LUKAKU","NAP",[45,60,52.5],{"t":4,"a":4,"i":3,"f":7.0},{"g":2,"as":1.0,"rs":0,"rsb":0,"p":2,"pt":0,"pi":0.0,"min":0.0,"mv":7.5,"fexp":6.5},{"amm":0,"esp":0,"bud":0.0,"pma":"","quo":0},"Semitop",{"comm":"","n1":"","n2":"","n3":"","n4":"","n5":""},{"sos_fanta_2025":45,"sos_fanta_2024":45,"profeta_2025":55,"profeta_2024":55,"fantaboom_2025":60,"fantaboom_2024":60,"fantaclassic_2025":50,"fantaclassic_2024":50}]]};

        // Global variables
        let currentRole = 'all';
        let searchTerm = '';
        let currentFilters = {
            price: 'all',
            reliability: 'all', 
            opportunity: 'all',
            minPrice: 1,
            maxPrice: 100
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            initializeApp();
            setupEventListeners();
            renderPlayers();
            updateSidebarStats();
            generateAIInsights();
        });

        function initializeApp() {
            // Calculate total players
            const totalPlayers = Object.values(PLAYERS_DB).reduce((sum, role) => sum + role.length, 0);
            document.getElementById('total-players').textContent = totalPlayers;
            
            // Initialize range sliders
            document.getElementById('min-price').addEventListener('input', updatePriceRange);
            document.getElementById('max-price').addEventListener('input', updatePriceRange);
        }

        function setupEventListeners() {
            // Search input
            document.getElementById('search-input').addEventListener('input', handleSearch);
            
            // Role filters
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', handleRoleFilter);
            });
            
            // Advanced filters
            document.getElementById('price-filter').addEventListener('change', handleAdvancedFilter);
            document.getElementById('reliability-filter').addEventListener('change', handleAdvancedFilter);
            document.getElementById('opportunity-filter').addEventListener('change', handleAdvancedFilter);
            
            // Modal
            const modal = document.getElementById('player-modal');
            const closeModal = modal.querySelector('.close');
            closeModal.addEventListener('click', () => modal.style.display = 'none');
            
            window.addEventListener('click', (e) => {
                if (e.target === modal) modal.style.display = 'none';
            });
        }

        function handleSearch(e) {
            searchTerm = e.target.value.toLowerCase();
            renderPlayers();
        }

        function handleRoleFilter(e) {
            // Update active button
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            e.target.classList.add('active');
            
            currentRole = e.target.dataset.role;
            renderPlayers();
        }

        function handleAdvancedFilter() {
            currentFilters.price = document.getElementById('price-filter').value;
            currentFilters.reliability = document.getElementById('reliability-filter').value;
            currentFilters.opportunity = document.getElementById('opportunity-filter').value;
            renderPlayers();
        }

        function updatePriceRange() {
            const minPrice = parseInt(document.getElementById('min-price').value);
            const maxPrice = parseInt(document.getElementById('max-price').value);
            
            // Ensure min doesn't exceed max
            if (minPrice > maxPrice) {
                document.getElementById('min-price').value = maxPrice;
                currentFilters.minPrice = maxPrice;
            } else {
                currentFilters.minPrice = minPrice;
            }
            
            currentFilters.maxPrice = maxPrice;
            
            document.getElementById('min-price-val').textContent = currentFilters.minPrice;
            document.getElementById('max-price-val').textContent = currentFilters.maxPrice;
            
            renderPlayers();
        }

        function decodePlayer(playerArray, role) {
            // Decode player data structure based on role
            const baseData = {
                nome: playerArray[0],
                team: playerArray[1],
                prezzi: {
                    min: playerArray[2][0],
                    max: playerArray[2][1],
                    avg: playerArray[2][2]
                },
                stats: playerArray[3],
                fascia: role === 'P' ? playerArray[5] : (role === 'D' ? playerArray[5] : playerArray[6]),
                allPrices: role === 'P' ? playerArray[6] : (role === 'D' ? playerArray[6] : playerArray[8])
            };

            // Add role-specific advanced stats
            if (role === 'P') {
                baseData.advanced = playerArray[4];
            } else if (role === 'D') {
                baseData.advanced = playerArray[4];
            } else if (role === 'C' || role === 'A') {
                baseData.performance = playerArray[4];
                baseData.discipline = playerArray[5];
                baseData.notes = playerArray[7];
            }

            return baseData;
        }

        function filterPlayers(players, role) {
            return players.filter(playerArray => {
                const player = decodePlayer(playerArray, role);
                
                // Search filter
                if (searchTerm) {
                    const searchStr = `${player.nome} ${player.team}`.toLowerCase();
                    if (!searchStr.includes(searchTerm)) return false;
                }
                
                // Price range filter
                const avgPrice = player.prezzi.avg;
                if (avgPrice < currentFilters.minPrice || avgPrice > currentFilters.maxPrice) return false;
                
                // Price tier filter
                if (currentFilters.price !== 'all') {
                    const priceMatches = {
                        'top': avgPrice >= 40,
                        'semitop': avgPrice >= 20 && avgPrice < 40,
                        'mid': avgPrice >= 10 && avgPrice < 20,
                        'low': avgPrice < 10
                    };
                    if (!priceMatches[currentFilters.price]) return false;
                }
                
                // Reliability filter
                if (currentFilters.reliability !== 'all') {
                    const reliability = player.stats.a || 3;
                    if (reliability !== parseInt(currentFilters.reliability)) return false;
                }
                
                // Opportunity filter (based on price variance)
                if (currentFilters.opportunity !== 'all') {
                    const variance = ((player.prezzi.max - player.prezzi.min) / player.prezzi.avg) * 100;
                    const opportunityMatches = {
                        'high': variance > 20,
                        'medium': variance >= 10 && variance <= 20,
                        'low': variance < 10
                    };
                    if (!opportunityMatches[currentFilters.opportunity]) return false;
                }
                
                return true;
            });
        }

        function getOpportunityLevel(player) {
            const variance = ((player.prezzi.max - player.prezzi.min) / player.prezzi.avg) * 100;
            if (variance > 20) return 'high';
            if (variance >= 10) return 'medium';
            return 'low';
        }

        function getReliabilityStars(reliability) {
            return '⭐'.repeat(reliability || 3);
        }

        function formatStatBadge(value, thresholds = [4, 3]) {
            if (value >= thresholds[0]) return 'excellent';
            if (value >= thresholds[1]) return 'good';
            return 'average';
        }

        function createPlayerCard(playerArray, role) {
            const player = decodePlayer(playerArray, role);
            const opportunity = getOpportunityLevel(player);
            const reliabilityStars = getReliabilityStars(player.stats.a);
            
            const opportunityColors = {
                'high': '#28a745',
                'medium': '#ffc107', 
                'low': '#6c757d'
            };

            const roleIcons = {
                'P': '🥅',
                'D': '🛡️',
                'C': '⚡',
                'A': '⚔️'
            };

            return `
                <div class="player-card" onclick="showPlayerDetails('${playerArray[0]}', '${role}')">
                    <div style="position: relative;">
                        ${opportunity === 'high' ? '<div class="opportunity-badge">🔥</div>' : ''}
                        <div class="player-info">
                            <div class="player-name">${roleIcons[role]} ${player.nome}</div>
                            <div class="player-team">${player.team} • ${player.fascia}</div>
                            <div class="player-stats">
                                <span class="stat-badge ${formatStatBadge(player.stats.t)}">
                                    Tit: ${player.stats.t || 3}/5
                                </span>
                                <span class="stat-badge ${formatStatBadge(player.stats.a)}">
                                    ${reliabilityStars}
                                </span>
                                <span class="stat-badge ${formatStatBadge(player.stats.i)}">
                                    Salute: ${player.stats.i || 3}/5
                                </span>
                                ${role === 'C' || role === 'A' ? `
                                    <span class="stat-badge ${formatStatBadge(player.performance?.g || 0, [3, 1])}">
                                        ⚽ ${player.performance?.g || 0}
                                    </span>
                                ` : ''}
                                ${role === 'C' || role === 'A' ? `
                                    <span class="stat-badge ${formatStatBadge(player.performance?.as || 0, [2, 1])}">
                                        🅰️ ${player.performance?.as || 0}
                                    </span>
                                ` : ''}
                            </div>
                        </div>
                        <div class="player-price">
                            <div class="smart-price" style="color: ${opportunityColors[opportunity]}">
                                €${player.prezzi.avg}
                            </div>
                            <div class="price-range">
                                €${player.prezzi.min}-${player.prezzi.max}
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderPlayers() {
            const playersGrid = document.getElementById('players-grid');
            const roles = currentRole === 'all' ? ['P', 'D', 'C', 'A'] : [currentRole];
            
            let allPlayersHtml = '';
            let totalFiltered = 0;

            const roleNames = {
                'P': '🥅 Portieri',
                'D': '🛡️ Difensori', 
                'C': '⚡ Centrocampisti',
                'A': '⚔️ Attaccanti'
            };

            roles.forEach(role => {
                const players = PLAYERS_DB[role] || [];
                const filteredPlayers = filterPlayers(players, role);
                totalFiltered += filteredPlayers.length;

                if (filteredPlayers.length > 0) {
                    allPlayersHtml += `
                        <div class="role-section">
                            <div class="role-header">
                                <div class="role-title">${roleNames[role]}</div>
                                <div class="role-count">${filteredPlayers.length}</div>
                            </div>
                            ${filteredPlayers.map(player => createPlayerCard(player, role)).join('')}
                        </div>
                    `;
                }
            });

            if (totalFiltered === 0) {
                allPlayersHtml = `
                    <div class="role-section">
                        <div style="text-align: center; padding: 40px; color: #666;">
                            <div style="font-size: 3rem; margin-bottom: 20px;">🔍</div>
                            <div style="font-size: 1.2rem; margin-bottom: 10px;">Nessun risultato trovato</div>
                            <div>Prova a modificare i filtri di ricerca</div>
                        </div>
                    </div>
                `;
            }

            playersGrid.innerHTML = allPlayersHtml;
            document.getElementById('filtered-count').textContent = totalFiltered;
            updateSidebarStats();
        }

        function updateSidebarStats() {
            const roles = currentRole === 'all' ? ['P', 'D', 'C', 'A'] : [currentRole];
            let allPrices = [];

            roles.forEach(role => {
                const players = PLAYERS_DB[role] || [];
                const filteredPlayers = filterPlayers(players, role);
                filteredPlayers.forEach(playerArray => {
                    const player = decodePlayer(playerArray, role);
                    allPrices.push(player.prezzi.avg);
                });
            });

            if (allPrices.length > 0) {
                const avgPrice = Math.round(allPrices.reduce((a, b) => a + b, 0) / allPrices.length);
                document.getElementById('avg-price').textContent = `€${avgPrice}`;
            }

            updateTopOpportunities();
        }

        function updateTopOpportunities() {
            const opportunities = [];
            
            Object.entries(PLAYERS_DB).forEach(([role, players]) => {
                players.forEach(playerArray => {
                    const player = decodePlayer(playerArray, role);
                    const opportunity = getOpportunityLevel(player);
                    const variance = ((player.prezzi.max - player.prezzi.min) / player.prezzi.avg) * 100;
                    
                    if (opportunity === 'high' && player.stats.a >= 4) {
                        opportunities.push({
                            ...player,
                            role,
                            variance,
                            targetPrice: Math.round(player.prezzi.min * 1.1)
                        });
                    }
                });
            });

            opportunities.sort((a, b) => b.variance - a.variance);
            
            const topOpportunitiesList = document.getElementById('top-opportunities');
            const roleIcons = { 'P': '🥅', 'D': '🛡️', 'C': '⚡', 'A': '⚔️' };
            
            topOpportunitiesList.innerHTML = opportunities.slice(0, 5).map(opp => `
                <li class="recommendation" onclick="showPlayerDetails('${opp.nome}', '${opp.role}')">
                    <div class="recommendation-text">
                        ${roleIcons[opp.role]} ${opp.nome} (${opp.team})
                    </div>
                    <div class="recommendation-price">
                        Target: €${opp.targetPrice} (Risparmio: €${Math.round(opp.prezzi.avg - opp.targetPrice)})
                    </div>
                </li>
            `).join('') || '<li class="recommendation"><div class="recommendation-text">Nessuna opportunità con i filtri attuali</div></li>';
        }

        function generateAIInsights() {
            const insights = [
                "I difensori dell'Inter mostrano il miglior rapporto qualità-prezzo questa stagione",
                "Mercato degli attaccanti in rialzo del 12% rispetto alla stagione scorsa",
                "Portieri con alta affidabilità disponibili sotto i 30 crediti",
                "Centrocampisti con bonus assist sottovalutati nelle fasce medie",
                "Trend positivo per i giocatori della Juventus dopo gli ultimi acquisti"
            ];

            const randomInsight = insights[Math.floor(Math.random() * insights.length)];
            document.getElementById('ai-insight').textContent = randomInsight;
            
            // Update every 10 seconds
            setTimeout(generateAIInsights, 10000);
        }

        function showPlayerDetails(playerName, role) {
            const players = PLAYERS_DB[role] || [];
            const playerArray = players.find(p => p[0] === playerName);
            
            if (!playerArray) return;
            
            const player = decodePlayer(playerArray, role);
            const modal = document.getElementById('player-modal');
            const detailsContainer = document.getElementById('player-details');

            const roleIcons = { 'P': '🥅', 'D': '🛡️', 'C': '⚡', 'A': '⚔️' };
            
            let detailsHtml = `
                <h2>${roleIcons[role]} ${player.nome}</h2>
                <p style="color: #666; margin-bottom: 20px;">${player.team} • ${player.fascia}</p>
                
                <div class="player-details">
                    <div class="detail-section">
                        <div class="detail-title">💰 Analisi Prezzi Smart</div>
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 15px;">
                            <div style="text-align: center;">
                                <div style="font-size: 1.5rem; font-weight: bold; color: #dc3545;">€${player.prezzi.min}</div>
                                <div style="font-size: 0.9rem; color: #666;">Minimo</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 1.8rem; font-weight: bold; color: #667eea;">€${player.prezzi.avg}</div>
                                <div style="font-size: 0.9rem; color: #666;">Consenso</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 1.5rem; font-weight: bold; color: #28a745;">€${player.prezzi.max}</div>
                                <div style="font-size: 0.9rem; color: #666;">Massimo</div>
                            </div>
                        </div>
                        <div class="price-analysis">
            `;

            // Show all source prices
            Object.entries(player.allPrices).forEach(([source, price]) => {
                const cleanSource = source.replace(/_\d{4}/, '').replace('_', ' ').toUpperCase();
                detailsHtml += `
                    <div class="source-price">
                        <div class="source-name">${cleanSource}</div>
                        <div class="source-value">€${price}</div>
                    </div>
                `;
            });

            detailsHtml += `
                        </div>
                    </div>
                    
                    <div class="detail-section">
                        <div class="detail-title">📊 Statistiche Essenziali</div>
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;">
                            <div>
                                <strong>Titolarità:</strong> ${getReliabilityStars(player.stats.t)} (${player.stats.t}/5)
                            </div>
                            <div>
                                <strong>Affidabilità:</strong> ${getReliabilityStars(player.stats.a)} (${player.stats.a}/5)
                            </div>
                            <div>
                                <strong>Integrità:</strong> ${getReliabilityStars(player.stats.i)} (${player.stats.i}/5)
                            </div>
                            <div>
                                <strong>FMV:</strong> ${player.stats.f || 'N/A'}
                            </div>
                        </div>
                    </div>
            `;

            // Role-specific advanced stats
            if (role === 'C' || role === 'A') {
                detailsHtml += `
                    <div class="detail-section">
                        <div class="detail-title">⚽ Performance</div>
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px;">
                            <div><strong>Gol:</strong> ${player.performance?.g || 0}</div>
                            <div><strong>Assist:</strong> ${player.performance?.as || 0}</div>
                            <div><strong>Presenze:</strong> ${player.performance?.p || 0}</div>
                            <div><strong>Rigoristi:</strong> ${player.performance?.rs || 0}</div>
                            <div><strong>Media Voto:</strong> ${player.performance?.mv || 'N/A'}</div>
                            <div><strong>FMV Exp:</strong> ${player.performance?.fexp || 'N/A'}</div>
                        </div>
                    </div>
                `;
            }

            detailsHtml += `
                    <div class="detail-section">
                        <div class="detail-title">🎯 Raccomandazione AI</div>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid #667eea;">
                            <strong>Prezzo Target:</strong> €${Math.round(player.prezzi.avg * 0.95)}<br>
                            <strong>Opportunità:</strong> ${getOpportunityLevel(player).toUpperCase()}<br>
                            <strong>Strategia:</strong> ${getOpportunityLevel(player) === 'high' ? 'Punta al prezzo minimo, alta volatilità' : 'Prezzo stabile, offri vicino al consenso'}
                        </div>
                    </div>
                </div>
            `;

            detailsContainer.innerHTML = detailsHtml;
            modal.style.display = 'block';
        }

        // Add some dynamic behavior
        setInterval(() => {
            document.getElementById('rising-trend').textContent = `+${Math.floor(Math.random() * 20 + 5)}%`;
        }, 5000);

        // Add loading completion
        setTimeout(() => {
            document.querySelector('.loading')?.remove();
        }, 1000);
    </script>
</body>
</html>